services:
  mssql:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver-test
    restart: always
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: ${SA_PASSWORD:-P@ssw0rd123!}
      MSSQL_PID: ${MSSQL_PID:-Express}
    ports:
      - "127.0.0.1:1433:1433"
    volumes:
      - mssql_data:/var/opt/mssql

  cloudbeaver:
    image: dbeaver/cloudbeaver:latest
    container_name: cloudbeaver
    restart: always
    ports:
      - "127.0.0.1:8978:8978"
    volumes:
      - cloudbeaver_data:/opt/cloudbeaver/workspace
      - ./cloudbeaver-config/initial-data-sources.conf:/opt/cloudbeaver/conf/initial-data-sources.conf:ro
    environment:
      CB_SERVER_NAME: ${CB_SERVER_NAME:-SQL Server Test}
      CB_ADMIN_NAME: ${CB_ADMIN_NAME:-cbadmin}
      CB_ADMIN_PASSWORD: ${CB_ADMIN_PASSWORD:-P@ssw0rd123!}
      CLOUDBEAVER_APP_GRANT_CONNECTIONS_ACCESS_TO_ANONYMOUS_TEAM: "true"
    depends_on:
      - mssql

volumes:
  mssql_data:
  cloudbeaver_data:
